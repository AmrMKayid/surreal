# Installing Surreal
[Install and Run SURREAL Locally](#install-and-run-surral-locally)
[Run Surreal on Google Cloud](#run-surreal-on-google-cloud)
[Setup Custom Docker Build Process](#setup-custom-docker-build-process)
[Develop Algorithms Locally](#develop-algorithms-locally)
[Develop Algorithms on Google Cloud](#develop-algorithms-on-google-cloud)


## Install and Run SURREAL Locally
* **Creating python environment** Surreal runs on python 3, we recommend using conda or a virtual environment. For example:
```bash
wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh 
source ~/.bashrc 
conda create -n surreal python=3.5
source activate surreal
```

* Install [pytorch](https://pytorch.org/get-started/locally/).

* Install surreal
```bash
pip install surreal
```

* Setup `.surreal.yml`. Run the following command to setup the surreal config file at `~/.surreal.yml`. 
```bash
surreal-default-config
```
Then follow [this guide](yaml_config.md) to setup the config file.

* Install environments
You can install RL environments depending on your need. The supported environments are [gym](https://github.com/openai/gym), [DeepMind Control Suite](https://github.com/deepmind/dm_control), and [Stanford Robotics Suite](https://github.com/StanfordVL/MujocoManipulation/tree/refactor4release).
# TODO(optional): step by step installation commands

* Create an experiment
You are now ready to create an experiment. Run
```bash
turreal create <experiment_name>
```
If you setup your `.surreal.yml` as default, you will see experiment outputs in `~/turreal/experiment_name` and see tensorboard output at `localhost:6006`.

Use `turreal p` to check the status of each process.
```bash
turreal p
>Group  Name         status  
>       tensorplex   live    
>       learner      live    
>       agent-0      live    
>       loggerplex   live    
>       agent-1      live    
>       tensorboard  live    
>       replay       live    
>       eval-0       live    
>       ps           live  
```

Use `turreal logs` to inspect logs of different components.
```bash
turreal logs learner
> ...
```

You can use `turreal delete` to terminate the experiment.
```bash
turreal delete
> Terminating
```
TODO (optional): more documentation on turreal


## Run SURREAL on Google Cloud
TODO: AWS and etc.

To run large scale experiments, you need to setup Surreal on a kubernetes cluster. Here we provide the guide for Google Cloud.

* Create a google cloud project, follow the guide in [Cloudwise](https://github.com/SurrealAI/cloudwise) to setup the kubernetes cluster. You should be able to verify that your kubectl commandline is connected to a cluster.
```bash
kubectl cluster-info
> Kubernetes master is running at ...
> ...
```

* In the previous step, you will obtain a `<cluster_name>.tf.json` file. This is generated by cloudwise to provide information about the cluster and ease scheduling. You need to provide the path to this file in `.surreal.yml`
```yaml
# ~/.surreal.yml
...
cluster_definition: <path to cluster_name.tf.json>
...
```

* To launch an experiment on the cloud, you also need to configure the `creation_settings` field in `.surreal.yml`. This allows you to choose how to schedule things, etc. The first settings in the template is provided here. For details about creation settings, check [the documentation](creation_settings.md).
```yaml
  cpu-experiment:
    # Currently there is only one mode available
    mode: basic
    # Number of agent pods
    num_agents: 2
    # Number of eval pods
    num_evals: 1
    # Number of agent processes per pod
    agent_batch: 1
    # Number of eval processes per pod
    eval_batch: 1
    # RL algorithm to use (ddpg / ppo) or path to a .py excecutable file in the container
    # The .py excecutable should at least support the interface of surreal/main/ddpg.py and surreal/main/ppo.py
    algorithm: ppo
    # Environment to use, see TODO for details
    env: gym:HalfCheetah-v2
    agent:
      image: surreal-cpu-image # TODO
      build_image: null
      scheduling:
        # Configure scheduling depending on your need
        assign_to: resource
        cpu: 1.5
    nonagent:
      image: surreal-cpu-image # TODO
      build_image: null
      # Configure scheduling depending on your need
      scheduling:
        assign_to: resource
        cpu: 7
```

* With everything setup. You can use the `kurreal` commandline to create the distributed experiment. 
```bash
kurreal create cpu-experiment my-first-experiment
kurreal p # wait until kurreal p shows everything to be running
kurreal tensorboard
```
For more creation customization and more information about `kurreal`, see [kurreal documentation](kurreal.md).

TODO: add some actions to take in 

## Setup Custom Docker Build Process
If you want to use mujoco environments on the cloud, you need to provide a valid mujoco liscense in the container that you deploy. We provide docker builder (powered by [Symphony](https://github.com/SurrealAI/symphony)) that puts together a docker build environment from multiple locations in your file system.

---
**Installation**
* Install [Docker](https://www.docker.com).
* Ensure that a valid multi-machine Mujoco Liscense is located at `~/mjkey.txt`.
* In your `.surreal.yml`, there is a `mujoco-experiment`. In `mujoco-experiment`, ...


## Develop Algorithms Locally

## Develop Algorithms on Google Cloud

## Contributing