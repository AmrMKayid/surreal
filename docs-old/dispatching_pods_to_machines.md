# How to assign pods to machines
Symphony allows us to set node selectors and pod taint tolerations to control pod scheduling on kubernetes. However, it is tedious to manage all the labels and make sure that the pod claims enough resources. Thus we have developed additional helpers to do the job. 

[This file](https://github.com/SurrealAI/Surreal/blob/new_cluster/surreal/kube/cluster_definition.tf.json) at `surreal/kube/cluster_definition.tf.json` is generated by [cloudwise](https://github.com/SurrealAI/cloudwise) that defines a kubernetes cluster. It is important to note the name attribute/label as this is how the dispatcher (see below) will know which node pool you are talking about.

There are certain labels created by cloudwise so that symphony can understand how to assign pods by reading and parsing the json. Specifically, giving a symphony `Process` instance and the name of the desired node pool name to `GKEMachineDispatcher` will ask it to schedule the node into this node pool. If you set `exclusive=True`, the dispatcher will claim (almost) all the available resources on the node. So no other pods will interfere. Otherwise you have to declare resource request/limit on your own. For an example see [here](https://github.com/SurrealAI/Surreal/blob/acb06f0df62067634b8b772d77705ab36fdb0779/surreal/kube/kurreal.py#L680).

A lot of the settings about how to initialize a pod is coded into the `pod_types` dictionary in `.surreal.yml`. With our new dispatcher it has been simplified to three things: for each component (e.g. agent, learner), you need to declare the image to build, the repository to push to and where to schedule the pod.