# docker build -f DockerfileLearnToRunCPUBase -t learn-to-run-cpu-base .
FROM ubuntu:16.04

LABEL author="Stanford Surreal team"

## Base dependency
RUN mkdir /mylibs
WORKDIR /mylibs
RUN apt-get update && apt-get install -y cmake unzip bzip2 curl git wget libglfw3 libglew1.13 libglu1-mesa-dev libglew-dev libgl1-mesa-dev libgl1-mesa-glx libglew-dev libosmesa6-dev xserver-xorg-video-dummy xorg-dev patchelf

# Miniconda
WORKDIR /mylibs
RUN curl -LO http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh \
	&& bash Miniconda3-latest-Linux-x86_64.sh -p /mylibs/miniconda -b
RUN rm /mylibs/Miniconda3-latest-Linux-x86_64.sh
ENV PATH=/mylibs/miniconda/bin:${PATH}

# python 3.6.1 is specifically required for opensim to work. 3.6.4 will break!!
RUN conda install --yes python=3.6.1
RUN conda install --yes -c kidzik opensim
RUN conda install --yes -c conda-forge lapack git
RUN pip install git+https://github.com/stanfordnmbl/osim-rl.git

# pytorch
RUN conda install --yes pytorch-cpu torchvision -c pytorch
COPY requirements.txt /mylibs/
RUN pip install -r /mylibs/requirements.txt

# required for imageio
RUN conda install -y ffmpeg -c conda-forge

COPY test_learn_to_run.py /mylibs/
