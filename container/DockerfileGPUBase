from nvidia/cuda:9.0-cudnn7-runtime-ubuntu16.04

LABEL author="Stanford Surreal team"

RUN mkdir /mylibs
WORKDIR /mylibs

RUN apt-get update && apt-get -y install cmake unzip bzip2 curl git wget libglfw3 libglew1.13 libglib2.0-0 libsm6 xorg-dev libglu1-mesa-dev libglew-dev libgl1-mesa-dev libgl1-mesa-glx libglew-dev libosmesa6-dev patchelf

# mujoco
RUN mkdir /root/.mujoco
WORKDIR /root/.mujoco
RUN wget https://www.roboti.us/download/mjpro150_linux.zip \
    && unzip mjpro150_linux.zip \
    && rm mjpro150_linux.zip
COPY mjkey.txt /root/.mujoco/mjkey.txt
ENV LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/root/.mujoco/mjpro150/bin

# python deps
WORKDIR /mylibs
RUN curl -LO http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh \
	&& bash Miniconda3-latest-Linux-x86_64.sh -p /mylibs/miniconda -b
RUN rm /mylibs/Miniconda3-latest-Linux-x86_64.sh
ENV PATH=/mylibs/miniconda/bin:${PATH}

# pytorch
RUN conda install --yes pytorch torchvision cuda90 -c pytorch
COPY requirements.txt /mylibs/
RUN pip install -r /mylibs/requirements.txt

# DM control suite
RUN pip install git+git://github.com/deepmind/dm_control.git

ENV DISABLE_MUJOCO_RENDERING=1